<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penawaran eHose Fiber - PT. Glori Mitra Sukses</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        [id="root"]:empty {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: sans-serif;
            background: #f8fafc;
        }
        [id="root"]:empty::after {
            content: "Menyiapkan Sistem Penawaran...";
            font-weight: bold;
            color: #2563eb;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        const App = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [data, setData] = useState([]); 
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedCity, setSelectedCity] = useState('Semua Kota');
            const [selectedLead, setSelectedLead] = useState(null);
            const [isModalOpen, setIsModalOpen] = useState(false);
            
            const salesName = 'Kherisno';
            const companyName = 'PT. Glori Mitra Sukses';

            // Master Data Awal
            const [masterPrices] = useState([
                { id: 1, category: "ADSS", name: "CABLE ADSS 288 CORE 4 KM", isp: 180000000 },
                { id: 3, category: "Drop Core", name: "FTTH DROP CABLE 1 KM", isp: 650000 }
            ]);

            const [quoteConfig, setQuoteConfig] = useState({
                selectedCategories: ['ADSS']
            });

            // Fungsi untuk menjalankan icon lucide setelah render
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            });

            const cities = useMemo(() => ['Semua Kota', ...Array.from(new Set(data.map(d => d.city))).sort()], [data]);
            
            const filteredLeads = useMemo(() => data.filter(item => {
                const name = item.company || '';
                return name.toLowerCase().includes(searchTerm.toLowerCase()) && 
                       (selectedCity === 'Semua Kota' || item.city === selectedCity);
            }), [data, searchTerm, selectedCity]);

            const formatIDR = (val) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(val);

            const handleUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (ev) => {
                    const lines = ev.target.result.split('\n').filter(l => l.trim());
                    const parsed = lines.slice(1).map((line, i) => {
                        const cols = line.split(/[;,]/).map(c => c.trim().replace(/"/g, ''));
                        return { id: i, company: cols[0], city: cols[9] || 'Luar Kota' };
                    });
                    setData(parsed);
                };
                reader.readAsText(file);
            };

            return (
                <div className="min-h-screen bg-slate-50 text-slate-900 pb-10">
                    <header className="bg-white border-b-4 border-blue-600 p-4 shadow-md flex justify-between items-center sticky top-0 z-50">
                        <div className="flex items-center gap-3">
                            <div className="bg-blue-600 p-2 rounded-lg text-white">
                                <i data-lucide="building-2"></i>
                            </div>
                            <h1 className="font-black text-lg uppercase">{companyName}</h1>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={() => setActiveTab('dashboard')} className={`px-4 py-2 rounded-xl text-xs font-bold ${activeTab === 'dashboard' ? 'bg-blue-600 text-white' : 'bg-slate-100'}`}>DASHBOARD</button>
                            <button onClick={() => setActiveTab('harga')} className={`px-4 py-2 rounded-xl text-xs font-bold ${activeTab === 'harga' ? 'bg-blue-600 text-white' : 'bg-slate-100'}`}>LIST HARGA</button>
                        </div>
                    </header>

                    <main className="max-w-6xl mx-auto p-6">
                        <div className="bg-gradient-to-r from-blue-700 to-indigo-800 p-8 rounded-3xl text-white mb-8 shadow-xl">
                            <h2 className="text-2xl font-black mb-2">Halo, {salesName}</h2>
                            <p className="text-blue-100 text-sm mb-6">Import database pelanggan (CSV) untuk membuat penawaran otomatis.</p>
                            <label className="bg-white text-blue-700 px-6 py-3 rounded-2xl font-black text-sm cursor-pointer shadow-lg hover:bg-blue-50 transition-colors">
                                UPLOAD DATA CSV <input type="file" className="hidden" accept=".csv" onChange={handleUpload} />
                            </label>
                        </div>

                        <div className="flex gap-4 mb-6">
                            <input 
                                type="text" 
                                placeholder="Cari nama perusahaan..." 
                                className="flex-1 p-4 rounded-2xl border-none shadow-sm outline-none focus:ring-2 focus:ring-blue-500"
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                            <select className="p-4 rounded-2xl bg-white shadow-sm font-bold text-sm outline-none" onChange={(e) => setSelectedCity(e.target.value)}>
                                {cities.map(c => <option key={c} value={c}>{c}</option>)}
                            </select>
                        </div>

                        <div className="bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden">
                            <table className="w-full text-left">
                                <thead className="bg-slate-50 text-[10px] font-black uppercase text-slate-400">
                                    <tr>
                                        <th className="p-6">Nama Perusahaan</th>
                                        <th className="p-6">Wilayah</th>
                                        <th className="p-6 text-right">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-slate-100">
                                    {filteredLeads.map(lead => (
                                        <tr key={lead.id} className="hover:bg-blue-50/50">
                                            <td className="p-6 font-bold">{lead.company}</td>
                                            <td className="p-6 text-sm text-slate-500">{lead.city}</td>
                                            <td className="p-6 text-right">
                                                <button onClick={() => { setSelectedLead(lead); setIsModalOpen(true); }} className="bg-slate-900 text-white px-5 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-blue-600 transition-colors">Penawaran</button>
                                            </td>
                                        </tr>
                                    ))}
                                    {filteredLeads.length === 0 && (
                                        <tr><td colSpan="3" className="p-10 text-center text-slate-400 italic text-sm">Belum ada data. Silakan upload file CSV.</td></tr>
                                    )}
                                </tbody>
                            </table>
                        </div>
                    </main>

                    {isModalOpen && selectedLead && (
                        <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm">
                            <div className="bg-white w-full max-w-lg rounded-[2.5rem] p-8 shadow-2xl relative">
                                <button onClick={() => setIsModalOpen(false)} className="absolute right-6 top-6 text-slate-300 hover:text-slate-600">
                                    <i data-lucide="x"></i>
                                </button>
                                <h2 className="text-xl font-black mb-1">{selectedLead.company}</h2>
                                <p className="text-xs text-slate-400 mb-8 uppercase tracking-widest">{selectedLead.city}</p>
                                
                                <div className="bg-blue-50 p-6 rounded-3xl mb-8">
                                    <p className="text-[10px] font-black text-blue-400 uppercase mb-2">Estimasi Total (Inc. PPN 11%)</p>
                                    <p className="text-3xl font-black text-blue-700">{formatIDR(180000000)}</p>
                                </div>

                                <button onClick={() => alert('PDF sedang diproses...')} className="w-full bg-blue-600 text-white py-4 rounded-2xl font-black text-sm shadow-xl shadow-blue-100 hover:scale-[1.02] transition-transform">
                                    UNDUH SURAT PENAWARAN
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
